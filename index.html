<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dolarpan Calc - Beta</title>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
    <script defer src="https://unpkg.com/alpinejs@3.10.4/dist/cdn.min.js"></script>
</head>

<body>
    <main class="container">
        <h3>Calcular precios</h3>
        <p>Consulta la tasa del dÃ­a ðŸ‘‰ <a href="https://t.me/dolarpan_bot">Dolarpan Bot</a>.</p>
        <div x-data="load()">
            <!-- Tasa de cambio -->
            <label for="tasa">Tasa Bs.</label>
            <input id="tasa" x-model="tasa" placeholder="0.00" x-text="getRate()" type="number" step="0.01" required>
            <hr>
            <!-- Descripcion del producto -->
            <label for="desc">ArtÃ­culo</label>
            <input id="desc" x-model="desc" placeholder="Descripcion del producto" type="text">
            <!-- Precio del producto -->
            <label for="precio">Precio</label>
            <input id="precio" x-model="precio" placeholder="0.00" type="number" step="0.01">
            <!-- Moneda en la que esta expresado el precio-->
            <template x-for="(currency, index) in monedas" :key="index">
                <div>
                    <input x-model="moneda" type="radio" :value="currency" :id="index">
                    <label :for="index" x-text="currency"></label>
                </div>
            </template>
            <br>
            <button x-on:click="addItem">Agregar</button>
            <hr>
            <figure>
                <table>
                    <thead>
                        <tr>
                            <th>ArtÃ­culos</th>
                            <th>Bs</th>
                            <th>$</th>
                            <th>-</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in items" :key="index">
                            <tr>
                                <td x-text="item.desc"></td>
                                <td x-text="item.ves_precio"></td>
                                <td x-text="item.usd_precio"></td>
                                <td><button @click="deleteItem(index)">X</button></td>
                            </tr>
                        </template>
                    </tbody>
                    <!-- TODO: 
                        - Calcular total en ambas monedas.
                        - Agregar cantidad para calcular subtotales.
                     -->
                </table>
            </figure>
        </div>
    </main>
    <script>
        function load() {
            return {
                items: [],
                tasa: "",
                desc: "",
                precio: "",
                moneda: "BolÃ­vares",
                monedas: ["BolÃ­vares", "DÃ³lares"],
                addItem() {
                    if (desc.value == "" || precio.value == "" || tasa.value == "") {
                        return
                    }
                    if (this.moneda == "DÃ³lares") {
                        tmp_usd = precio.value
                        tmp_ves = tmp_usd * tasa.value
                    } else {
                        tmp_ves = precio.value
                        tmp_usd = tmp_ves / tasa.value
                    }
                    this.items.push({
                        desc: desc.value,
                        ves_precio: parseFloat(tmp_ves).toFixed(2),
                        usd_precio: parseFloat(tmp_usd).toFixed(2),
                        moneda: this.moneda,
                    })
                    this.desc = ""
                    this.precio = ""
                    this.moneda = "BolÃ­vares"
                },
                deleteItem(index) {
                    this.items = this.items.filter((items, itemIndex) => {
                        return index !== itemIndex
                    })
                },
                getRate() {
                    fetch("https://dolarpan.pythonanywhere.com/api/v1/monitor")
                        .then(res => res.json())
                        .then(data => this.tasa = data);
                }
            }
        }
    </script>
</body>

</html>